# 実装計画書 05: リスク / 未確定事項

## リスク一覧
- リスク: Message Content Intent 未有効/未承認で Thread 継続会話が破綻
  - 影響: Bot がユーザー入力を取得できない
  - 対策: インタラクション UI 化 / メンション必須化 / Intent 申請
- リスク: Message Content Intent の有効化漏れ
  - 影響: Thread 内のメッセージが取得できず会話が成立しない
  - 対策: 起動時のチェック/ログ、セットアップ手順に明記
- リスク: LLM 出力が JSON 逸脱し Tool 実行が失敗
  - 影響: 操作不能・再試行ループ
  - 対策: JSON Schema 検証 + 再試行回数制限 + フォールバック文言
- リスク: Discord レート制限超過
  - 影響: Bot の一時停止、操作失敗
  - 対策: キュー / バックオフ / ギルド単位のレート制限
- リスク: 多段階ループが暴走し、意図以上の操作を提案/実行する
  - 影響: 大量変更・誤変更
  - 対策: ステップ上限、1回の actions[] 上限、destructive は必ず human approval、影響範囲の要約を必須化
- リスク: 破壊的操作の誤実行
  - 影響: チャンネル/ロール消失など重大事故
  - 対策: 二段階確認 + 影響範囲明示 + 監査ログ必須
- リスク: プロンプト注入（ユーザー文/ツール出力を通じた誘導）
  - 影響: 禁止操作の試行、意図しない情報流出、危険なツール実行
  - 対策: untrusted input を system/developer 指示に混ぜない、structured outputs、allowlist、承認必須化、評価と監視
- リスク: “ID を教えてください” が頻発し UX が悪化（観測不足）
  - 影響: 管理作業が進まない、ユーザー離脱
  - 対策: 検索/一覧/詳細の観測ツールを先に整備し、候補提示→確定の UX を標準化
- リスク: 言語設定（日本語/英語）が一貫せず混在する
  - 影響: 体験が崩れる、誤解が増える
  - 対策: 全ユーザー向け文面を i18n 統一、フォールバック文言も言語別、LLM への言語指示を強制
- リスク: ログ保管が短期・最小限のため、事後調査が難しい
  - 影響: 問題発生時の原因追跡が困難
  - 対策: 破壊的操作のみ詳細ログを残す、必要時に保持期間を延長
- リスク: 暗号化キー紛失
  - 影響: API キー復号不可、運用停止
  - 対策: キー管理手順の明文化 + バックアップ

## 未確定事項
- Thread 継続会話の UX（メンション必須 / 追加 UI 必須）
- 5 プロバイダーのモデル ID / 料金 / レート制限
- destructive の定義（ルール固定 vs LLM 判定併用）と “承認必須カテゴリ” の最終線引き

## 追加の質問
- 管理対象の「メンバー管理補助」はどこまで許容するか
- 監査ログに保存してよい情報の範囲（PII 含むか）

## ギャップ分析（1回目）
- Thread 内の会話継続条件が未確定
- LLM プロバイダーのモデル ID が未確定

## ギャップ分析（2回目）
- 破壊的判定ルール（AI 判定 + 禁止操作ルール）の詳細が未定
- 運用時の障害対応手順が未定
- 評価（会話ログ/指標）に基づき改善できる仕組みが未定
