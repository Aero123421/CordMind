# 実装計画書 07: 運用 / 保守

## デプロイ方針
- Docker Compose で bot + Postgres を同居
- env / Docker secrets で機密情報を注入
- 方針: “必須は Discord Bot Token のみ” に寄せたい場合、暗号化キーは初回起動時に生成して永続ボリュームに保存する方式も検討（要セキュリティレビュー）

## 監視 / ログ
- 構造化ログ（JSON）を stdout 出力
- 監査ログは最小限・短期保管（破壊的操作中心）
- Discord ログチャンネルへの送信は任意（設定時のみ）
- エラー通知は Discord ログチャンネルへ送信（設定時のみ）
- 体感 UX 改善のため、任意で “デバッグモード（ツール結果の短い表示）” を有効化できるようにする

## SLO / アラート
- SLO: 主要操作の 95% が 10 秒以内に完了
- アラート: 連続失敗、レート制限多発、DB 接続失敗

## ロールバック
- コンテナイメージを前バージョンに戻す
- DB マイグレーションは後方互換を優先

## 運用手順
- 起動/停止/再起動は Docker Compose 経由
- API キー更新時は監査ログを確認
- 暗号化キーは安全な場所に保管
- Message Content Intent が開発者ポータルで有効化されているか確認

## 保守計画
- 依存ライブラリの定期更新
- Discord API 仕様変更の追従確認
- LLM プロバイダーのモデル更新確認
- 評価ログ（フィクスチャ）で回帰がないか確認
