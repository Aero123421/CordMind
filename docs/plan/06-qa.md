# 実装計画書 06: テスト / 検証

## テスト方針
- 権限・確認フロー・監査ログの正しさを最優先で検証
- LLM 出力の異常系（JSON 破損/未知ツール）を重点的に確認
- “エージェンティックさ”（観測→再計画、ID要求しない、言語一貫）を回帰させない

## テスト種別
- 単体: 権限チェック、レート制限、暗号化/復号、JSON Schema 検証
- 結合: Discord API 操作（チャンネル/ロール/権限）、監査ログ書き込み
- E2E: @メンション → Thread → 確認 → 実行 → 監査ログ
- 負荷/性能: ギルド単位で 10 ops/分程度を連続実行
- セキュリティ: 操作権限のバイパス/プロンプト注入の耐性
- 評価（Evals）: 代表ログで “成功/失敗” を定義し、改善前後で比較できるようにする

## 品質ゲート
- 破壊的操作は必ず二段階確認が入る
- 監査ログは失敗時も記録される
- JSON 逸脱時にツール実行が走らない
- 日本語設定ならユーザー向け文面が英語に戻らない
- “ID を教えて” が標準経路にならない（観測で解決できるものは解決する）

## 受け入れテスト
- 管理者のみが @メンションに応答できる
- Thread 継続会話で設定変更ができる（メンション不要）
- 「チャンネル削除」操作で確認 → 実行 → 監査ログが通る
- 「Bot 自身の BAN/Kick/Timeout」「サーバー削除」が拒否される
- /discordaimanage でプロバイダー/モデル/API キー設定ができる
- 「名前が長いな、vc3 に変えて」→ Bot が対象候補を特定し、ID 要求せずに変更案→（承認）→実行できる
- 「2人〜10人制限のVCを作って」→ 8個作成の意図を確認でき、まとめて提案→（承認）→実行できる
